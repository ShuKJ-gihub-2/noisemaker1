<input type="number" id="historyCount" value="500" min="1">
<button id="startBtn">100件ずつリロードして量産</button>
<div id="status" style="margin-top:10px; color: blue;"></div>

<script>
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const currentTotal = parseInt(urlParams.get('done') || "0");
        const maxTarget = parseInt(urlParams.get('target') || "0");

        if (maxTarget > 0 && currentTotal < maxTarget) {
            document.getElementById('status').innerText = `現在 ${currentTotal} / ${maxTarget} 件作成済み...`;

            // 今回のターンで何件追加するか（100件、または残り全数）
            const batchSize = Math.min(100, maxTarget - currentTotal);
            const currentPath = window.location.pathname;

            // 1. pushStateで100件（または残り）を一気に生成
            for (let i = 1; i <= batchSize; i++) {
                const dummyUrl = `${currentPath}?done=${currentTotal + i}&target=${maxTarget}`;
                window.history.pushState({ page: currentTotal + i }, "", dummyUrl);
            }

            // 2. 100件たまったらリロードして「履歴の寿命」をリセット
            const nextTotal = currentTotal + batchSize;
            if (nextTotal < maxTarget) {
                // 少しだけ待ってから次のページへ（ブラウザの処理落ち防止）
                setTimeout(() => {
                    window.location.href = `?done=${nextTotal}&target=${maxTarget}`;
                }, 100);
            } else {
                document.getElementById('status').innerText = `${maxTarget} 件の履歴をすべて生成しました！`;
                alert("完了しました！戻るボタンを長押しして確認してください。");
            }
        }
    };

    document.getElementById('startBtn').onclick = function() {
        const count = document.getElementById('historyCount').value;
        // 最初の実行を開始
        window.location.href = `?done=0&target=${count}`;
    };
</script>
